var e={d:(t,l)=>{for(var o in l)e.o(l,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:l[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};function l(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function o(e,t,l){return"#"+a(e)+a(t)+a(l)}function a(e){let t=e.toString(16);return 1==t.length?"0"+t:t}e.d(t,{cR:()=>i,X1:()=>n,EU:()=>r,Cj:()=>s,Ay:()=>u,om:()=>c,Jx:()=>h});const i=["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","copy","xor","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"];class n{constructor(){this.id=l(),this.frames=[],this.layers=[],this.rulers=[],this.lastSave=(new Date).getTime(),this.created=(new Date).getTime(),this.authors=[],this.firstAuthor=null,this.lastAuthor=null,this.height=0,this.width=0,this.createdApp=null,this.savedApp=null,this.createdAppVer=null,this.savedAppVer=null}}class s{constructor(){this.id=l(),this.mode=null,this.name=null,this.visible=!0,this.opacity=100}}class r{constructor(){this.id=l(),this.layerData={}}}function c(e){const t=new n;if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return console.log(e),t}let l=null;e.data&&(l=e.data);for(let l in t)e[l]&&(t[l]=e[l]);l&&t.layers.push({data:l,mode:null,name:null,visible:!0});const o=[];let a=null;for(let e=0;e<t.layers.length;e++){const l=t.layers[e];if(!l)continue;const i=new s;for(let e in i)l[e]&&(i[e]=l[e]);l.data&&(a||(a={layerData:{}}),a.layerData[i.id]=l.data),o.push(i)}a&&t.frames.push(a),t.layers=o;const i=[];for(let e=0;e<t.frames.length;e++){const l=t.frames[e],o=new r;for(let e in o)l[e]&&(o[e]=l[e]);i.push(o)}if(t.frames=i,0==t.layers.length){const e=new s,l=new r;l.layerData[e.id]=[],t.frames.push(l),t.layers.push(e)}return t}function h(e){if(!e.source)return void console.log("No source data!");let t=null,a=1,i=0,n=null,s=null,r=[],h=null,u=null,d=1;e.color&&7==e.color.trim().length&&(s=e.color),e.outlineColor&&(u=e.outlineColor),e.colorReplacements&&(r=e.colorReplacements),null!=e.frame&&null!=e.frame&&(i=e.frame),null!=e.scale&&null!=e.scale&&(a=e.scale),e.callback&&(t=e.callback),e.gridlineImage&&(h=e.gridlineImage),null!=e.opacity&&null!=e.opacity&&(d=e.opacity),n=c(e.source);let f=n.height,g=n.width;if(e.accessories)for(let t=0;t<e.accessories.length;t++){const l=e.accessories[t];if(l.source){const e=l.source;e.width&&e.width>g&&(g=e.width),e.height&&e.height>f&&(f=e.height)}}const m=f*a,p=g*a;let y=p;-1==i&&(y=p*n.frames.length);const w=document.createElement("canvas"),P=w.getContext("2d");w.style.imageRendering="pixelated",P.imageSmoothingEnabled=!1,w.height=m,w.width=y,e.fill&&(P.fillStyle=e.fill,P.fillRect(0,0,y,m));let v=i,b=i+1;-1==i&&(v=0,b=n.frames.length);let x=0;const O=[];if(O.push({source:n,colorReplacements:r}),e.accessories)for(let t=0;t<e.accessories.length;t++){const l=e.accessories[t];O.push(JSON.parse(JSON.stringify(l)))}for(let e=0;e<O.length;e++){x=0;const t=O[e],l=t.source;let o=0;l.height<f&&(o+=f-l.height);let i=null,r={},c=0;t.colorReplacements&&(i=t.colorReplacements);for(let e=v;e<b;e++){const t=l.frames[e];if(t){for(let e=0;e<l.layers.length;e++){P.globalCompositeOperation="source-over";const n=l.layers[e];if(!n.visible)continue;const h=t.layerData[n.id];if(h){n.mode&&(P.globalCompositeOperation=n.mode),n.opacity&&n.opacity<100?P.globalAlpha=n.opacity/100:P.globalAlpha=1;for(let e=0;e<h.length;e++){const t=h[e];r[t.x+c+":"+t.y]=!0;const l=t.x*a+x,n=(t.y+o)*a;let u=t.c;if(s&&"#ff00ff"==u&&(u=s),i)for(let e=0;e<i.length;e++){const t=i[e].c,l=i[e].r;if(u==t){u=l;break}}P.fillStyle=u,P.fillRect(l,n,a,a)}}}c+=n.width,x+=p}}if(P.globalCompositeOperation="source-over",h)for(let e=0;e<l.width;e++)for(let t=0;t<l.height;t++){const l=e*a,o=t*a;P.drawImage(h,l,o,a,a)}if(u){const e=document.createElement("canvas"),t=e.getContext("2d");e.width=w.width,e.height=w.height,t.drawImage(w,0,0),P.fillStyle=u,P.globalCompositeOperation="source-over",P.globalAlpha=1;for(let e in r){const t=e.split(":"),l=parseInt(t[0]),o=parseInt(t[1]);for(let e=l-1;e<=l+1;e++)for(let t=o-1;t<=o+1;t++){const l=e*a,o=t*a;P.fillRect(l,o,a,a)}}P.drawImage(e,0,0)}}if(d<1){const e=document.createElement("canvas"),t=e.getContext("2d");e.height=m,e.width=y,t.drawImage(w,0,0),w.height=m,w.width=y,P.globalAlpha=d,P.drawImage(e,0,0)}if(e.asVPP)return void function(e,t,a){const i=t.getImageData(0,0,e.width,e.height),n=i.data;let s=0;const r={author:null,size:0,id:l(),voxels:[],precompiledat:null,vars:{created_timestamp:(new Date).getTime(),last_edit_timestamp:(new Date).getTime(),last_edit_app:null}};r.size=i.width,i.height>i.width&&(r.size=i.height),s=Math.floor(r.size/2);for(let e=0;e<n.length;e+=4){const t=Math.floor(e/4),l=Math.floor(t/i.width),a=t-l*i.width,c=n[e+0],h=n[e+1],u=n[e+2],d=n[e+3];if(0==d)continue;const f=o(c,h,u);let g={x:a-s,y:0,z:i.height-l-1,c:f,op:d/255};r.voxels.push(g)}a(r)}(w,P,t);if(e.asCanvas)return t?void t(w):w;const S=w.toDataURL();if(e.asDataURL)return t?void t(S):S;if(!t)return void console.log("Missing callback");const I=new Image;I.onload=function(){t(I)},I.src=S}const u={COMPOSIT_OPERATIONS:i,PixelPaintData:n,PixelPaintLayer:s,PixelPaintFrame:r,rebuildPPPFromJSON:c,renderPPP:h};var d=t.cR,f=t.X1,g=t.EU,m=t.Cj,p=t.Ay,y=t.om,w=t.Jx;export{d as COMPOSIT_OPERATIONS,f as PixelPaintData,g as PixelPaintFrame,m as PixelPaintLayer,p as default,y as rebuildPPPFromJSON,w as renderPPP};